# 設計プラン生成・検証ガイド

team-design.md の Step 13 以降で参照するガイド。
オーケストレータ（主セッション）が実行する。

## 設計プラン生成

全ワーカーの分析結果を統合し、以下を含む設計プランを生成する:
1. モジュール分割とコンポーネント構成
2. インターフェース定義（モジュール間の型・契約）
3. ファイル所有権の割り当て（Phase 4の各ワーカーに対応）
4. データフロー
5. クリアすべきAPIテスト項目（各APIの動作確認基準）

書き出し先: `/tmp/claude-team/${MASTER_TEAM_ID}/design-plan.md`

## スケルトンファイル生成（Interface Contract First）

design-plan.mdのインターフェース定義に基づき、スケルトンファイルを生成する。
Phase 4ワーカーはこれを基に実装することで、インターフェース不整合を構造的に防ぐ。

```bash
mkdir -p /tmp/claude-team/${MASTER_TEAM_ID}/skeletons
```

設計プランに含まれるインターフェース定義から、以下のようなファイルを生成:
- **型定義**: TypeScript型定義(`.ts`)、malliスキーマ(`.clj`)等
- **API契約**: ルーティング定義、エンドポイント仕様
- **共有定数**: 設定値、列挙型

各ファイルは実装の骨格のみ（シグネチャ、型、TODO コメント）とし、
`/tmp/claude-team/${MASTER_TEAM_ID}/skeletons/` 配下にプロジェクトのパス構造を再現して配置する。
design-plan.mdにスケルトンファイル一覧セクションを追記する。

## テスト項目の整合性検証

design-plan.md 内のAPI仕様とテスト項目を照合する:
- 全APIに対応するテスト項目が存在するか
- テスト項目がAPI仕様と矛盾していないか
- テストのカバレッジに漏れがないか
- スケルトンファイルの型定義とAPI仕様が一致しているか
不整合がある場合はオーケストレータ自身が修正してdesign-plan.mdとスケルトンを更新する。

## 設計プランの品質要件

設計プランは、Phase 4（実装）で複数ワーカーが並列作業しても不整合が起きない粒度で記述すること。
ファイル単位の分割書き込み指示、モジュール間インターフェースの型定義、
共有定数・型の一元管理方針を含めること。巨大ファイルの分割書き込みになる場合も、
インターフェースが明確であれば問題ない。

設計プランには「クリアすべきAPIテスト項目」セクションを必ず含めること。
各APIエンドポイント/インターフェースに対して、正常系・異常系の動作確認基準を定義する。
Phase 4の検証ステップでこのテスト項目をクリアすることが完了条件となる。
