# /cleanup - リポジトリ整理

staleなworktree、マージ済みブランチ、不要なトラッキングブランチを検出し、整理する。

**重要: 破壊的操作を含むため、すべての削除操作はユーザーに個別確認する。**

## 処理フロー

以下のステップを順に実行すること。

### 1. リモート情報の更新

- `git fetch --prune` でリモートの最新情報を取得し、削除済みリモートブランチの参照を整理

### 2. Worktreeの確認

- `git worktree list` で全worktreeを一覧
- 各worktreeについて:
  - パスが実際に存在するか確認
  - ブランチがマージ済みか確認
- 問題のあるworktreeを報告

### 3. マージ済みローカルブランチの検出

- `git branch --merged` でマージ済みブランチを一覧
- 現在のブランチ、main、masterは除外
- 各ブランチについて削除するかユーザーに**個別確認**
- 承認されたブランチを `git branch -d` で削除

### 4. リモートで削除済みのトラッキングブランチの検出

- `git branch -vv` でトラッキング状態を確認
- リモートブランチが `gone` になっているローカルブランチを検出
- 各ブランチについて削除するかユーザーに**個別確認**
- 承認されたブランチを `git branch -d` で削除（マージされていない場合は警告し、`-D` を使うか確認）

### 5. 不要なworktreeの整理

- ステップ2で検出された問題のあるworktreeについて:
  - パスが存在しないworktree: `git worktree prune` での整理を提案
  - マージ済みブランチのworktree: 削除を提案
- 各操作をユーザーに**個別確認**

### 6. 要約出力

以下の情報を報告:
- 削除されたローカルブランチ数とブランチ名
- 削除されたトラッキングブランチ数とブランチ名
- 整理されたworktree数
- 残っているworktreeの一覧
